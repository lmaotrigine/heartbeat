<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Configuration - Heartbeat</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Heartbeat</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/lmaotrigine/heartbeat/tree/main/book/src" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/lmaotrigine/heartbeat/edit/main/book/src/configuration.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>This document explains how Heartbeat’s configuration system works, as well as available keys or configuration.</p>
<h2 id="hierarchical-structure"><a class="header" href="#hierarchical-structure">Hierarchical structure</a></h2>
<p>Heartbeat allows configuration to be specified through a file, through environment variables, or in the command line
during invocation. If a key is specified in multiple locations, the value in the location with the highest priority will
take precedence. The locations in decreasing order of priority are:</p>
<ul>
<li>Command line</li>
<li>Environment variables</li>
<li>Config file fields</li>
</ul>
<h2 id="specifying-the-configuration-file"><a class="header" href="#specifying-the-configuration-file">Specifying the configuration file</a></h2>
<p>By default, Heartbeat looks for a configuration file called <code>config.toml</code> in the heartbeat home folder. This is usually
<code>~/.heartbeat</code> on Unix platforms and <code>%USERPROFILE%\.heartbeat</code> on Windows. This can be overridden by the
<code>HEARTBEAT_HOME</code> environment variable. If the file doesn’t exist, it silently moves on. This can be overridden by the
environment variable <code>HEARTBEAT_CONFIG_FILE</code>, or the command line flag <code>-c</code>/<code>--config-file</code>. If a regular file is not
found at the location pointed to by the value of this parameter, an error will be printed and Heartbeat will exit.</p>
<h2 id="configuration-format"><a class="header" href="#configuration-format">Configuration format</a></h2>
<p>Configuration files are written in the <a href="https://toml.io">TOML format</a>, with simple key-value pairs and sections (tables). Values
can be specified based on <a href="https://doc.rust-lang.org/stable/cargo/reference/profiles.html">profiles</a> using the <code>debug</code>
or <code>release</code> tables, both of which are optional. An example config file with all fields filled out is given below:</p>
<pre><code class="language-toml"># the address to bind to
# this will be parsed as a `std::net::SocketAddr`
bind = "0.0.0.0:6060"

# this is used for &lt;title&gt; tags
# and some headings
server_name = "Some person's heartbeat"

# the full url to the server
live_url = "http://127.0.0.1:6060"

# a random URL-safe string.
# if left blank, addition of devices is disabled.
# this may be generated using `openssl rand -base64 45`
secret_key = ""

# don't change this unless you're using a fork
repo = "https://github.com/lmaotrigine/heartbeat"

[database]
# this is the default if you're using the docker-compose file
# otherwise, the format is postgresql://username:password@host/database
dsn = "postgresql://heartbeat@db/heartbeat"

[webhook]
# leave this blank to disable webhooks
url = ""

# one of:
# - "all"             log each beat + the below
# - "new_devices"     log new devices + the below
# - "long_absences"   log absences longer than 1 hour
# - "none"            don't log anything
level = "none"

# override some values for debug builds for easier testing.

[debug]
bind = "127.0.0.1:6061"
live_url = "http://localhost:6061"

# nested keys work as expected
[debug.database]
dsn = "postgresql://heartbeat@localhost/heartbeat"
</code></pre>
<h2 id="environment-variables"><a class="header" href="#environment-variables">Environment variables</a></h2>
<p>Heartbeat can be configured through environment variables in addition to the TOML configuration file. Environment
variable names take the form of <code>HEARTBEAT_&lt;KEY&gt;</code> where <code>&lt;KEY&gt;</code> is the full path to the key in the TOML configuration,
in uppercase, with dots (<code>.</code>) replaced with underscores (<code>_</code>). For example, the <code>database.dsn</code> config value can be
specified through the environment variable <code>HEARTBEAT_DATABASE_DSN</code>. Environment variables will override the values in
the TOML configuration file, regardless of profile. Environment variable names must not contain the profile key.</p>
<h2 id="command-line-arguments"><a class="header" href="#command-line-arguments">Command line arguments</a></h2>
<p>Heartbeat can be configured by passing configuration values as command line parameters. Command line flags are formatted
as per the POSIX standard, with two leading dashes (<code>--</code>) and dots (<code>.</code>) and underscores (<code>_</code>) replaced with dashes
(<code>-</code>). For example, the <code>database.dsn</code> config value can be passed via the command line argument <code>--database-dsn=</code>. The
equals sign is optional. For a full list of available configuration values, their usage, default values, and available
shorthands, run <code>heartbeat --help</code>.</p>
<p>If any required configuration parameter is not specified (all parameters with no defaults are considered required),
Heartbeat will print an error message and exit.</p>
<h2 id="configuration-keys"><a class="header" href="#configuration-keys">Configuration keys</a></h2>
<p>This section documents all configuration keys.</p>
<h3 id="database"><a class="header" href="#database"><code>[database]</code></a></h3>
<p>the <code>[database]</code> table contains configuration related to the PostgreSQL database</p>
<h4 id="databasedsn"><a class="header" href="#databasedsn"><code>database.dsn</code></a></h4>
<ul>
<li>Type: string</li>
<li>Default: <code>postgresql://heartbeat@db/heartbeat</code> if running within Docker, <code>postgresql://postgres@localhost/postgres</code>
otherwise.</li>
<li>Environment: <code>HEARTBEAT_DATABASE_DSN</code></li>
<li>Command line: <code>-d</code>/<code>--database-dsn</code></li>
</ul>
<p>The PostgreSQL connection string for the database that Heartbeat should use. The database must exist, and the user must
have at least <code>CREATE SCHEMA</code> privileges on it.</p>
<h3 id="webhook"><a class="header" href="#webhook"><code>[webhook]</code></a></h3>
<p>The <code>[webhook]</code> table deals with configuration related to logging events to Discord webhooks. This is only relevant if
the <code>webhooks</code> feature is enabled, which is the default.</p>
<h4 id="webhookurl"><a class="header" href="#webhookurl"><code>webhook.url</code></a></h4>
<ul>
<li>Type: string</li>
<li>Default: empty</li>
<li>Environment: <code>HEARTBEAT_WEBHOOK_URL</code></li>
<li>Command line: <code>--webhook-url</code></li>
</ul>
<p>The URL to the Discord webhook to log events to. If empty, logging is disabled.</p>
<h4 id="webhooklevel"><a class="header" href="#webhooklevel"><code>webhook.level</code></a></h4>
<ul>
<li>Type: string, one of <code>all</code>, <code>new_devices</code>, <code>long_absences</code>, <code>none</code></li>
<li>Default: <code>none</code></li>
<li>Environment: <code>HEARTBEAT_WEBHOOK_LEVEL</code></li>
<li>Command line: <code>--webhook-level</code></li>
</ul>
<p>The maximum level of events to log to the webhook. The possible values in descending order of level are:</p>
<ul>
<li><code>all</code>: logs beats, along with everything below</li>
<li><code>new_devices</code>: logs when a new device is added, along with everything below</li>
<li><code>long_absences</code>: logs when an absence longer than 1 hour has ended.</li>
<li><code>none</code>: No events are logs.</li>
</ul>
<h3 id="secret_key"><a class="header" href="#secret_key"><code>secret_key</code></a></h3>
<ul>
<li>Type: string</li>
<li>Default: none</li>
<li>Environment: <code>HEARTBEAT_SECRET_KEY</code></li>
<li>Command line: <code>-s</code>/<code>--secret-key</code></li>
</ul>
<p>A random, header value safe string (≤256 bytes) that will be the master authentication token for administrative actions
like adding devices or regenerating their tokens. If this value is empty, administrative actions are disabled.</p>
<h3 id="repo"><a class="header" href="#repo"><code>repo</code></a></h3>
<ul>
<li>Type: string</li>
<li>Default: <code>https://github.com/lmaotrigine/heartbeat</code></li>
<li>Environment: <code>HEARTBEAT_REPO</code></li>
<li>Command line: <code>-r</code>/<code>--repo</code></li>
</ul>
<p>The URL to the repository of the Heartbeat source. This should be left unchanged unless you are running a fork.</p>
<h3 id="server_name"><a class="header" href="#server_name"><code>server_name</code></a></h3>
<ul>
<li>Type: string</li>
<li>Default: <code>Some person's heartbeat</code></li>
<li>Environment: <code>HEARTBEAT_SERVER_NAME</code></li>
<li>Command line: <code>--server-name</code></li>
</ul>
<p>A human-readable name for the server. Used in <code>&lt;title&gt;</code> tags and other metadata.</p>
<h3 id="live_url"><a class="header" href="#live_url"><code>live_url</code></a></h3>
<ul>
<li>Type: string</li>
<li>Default <code>http://127.0.0.1:6060</code></li>
<li>Environment: <code>HEARTBEAT_LIVE_URL</code></li>
<li>Command line: <code>-u</code>/<code>--live-url</code></li>
</ul>
<p>The publicly accessibly base URL for the Heartbeat server. This is used to format URLs in webhook logs so that they
resolve to the right routes. When running in production, this must be overridden.</p>
<h3 id="bind"><a class="header" href="#bind"><code>bind</code></a></h3>
<ul>
<li>Type: string, must be a valid socket address (either <code>&lt;host&gt;:&lt;port&gt;</code>, or a UDS).</li>
<li>Default: <code>127.0.0.1:6060</code></li>
<li>Environment: <code>HEARTBEAT_BIND</code></li>
<li>Command line: <code>-b</code>/<code>--bind</code></li>
</ul>
<p>The socket address for the server to bind to and listen on.</p>
<h3 id="config_file"><a class="header" href="#config_file"><code>config_file</code></a></h3>
<ul>
<li>Type: string, must be a path to a valid file</li>
<li>Default: <code>$HEARTBEAT_HOME/config.toml</code> (see <a href="#specifying-the-configuration-file">above</a> for more information)</li>
<li>Environment: <code>HEARTBEAT_CONFIG_FILE</code></li>
<li>Command line: <code>-c</code>/<code>--config-file</code></li>
</ul>
<p>This value obviously cannot be specified in the TOML configuration file. It can be set in the environment or provided in
the command line to override the default config file location.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="getting-started/running.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="clients/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="getting-started/running.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="clients/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
